# 任务管理界面UI升级设计文档

## 一、设计目标

对任务管理界面进行全面升级，参照飞书多维表格风格，实现视图切换、任务分组、表格化布局等现代化功能，提升用户体验和任务管理效率。

## 二、核心功能设计

### 2.1 视图切换系统

#### 2.1.1 视图类型
系统支持三种任务视图模式：

| 视图类型 | 功能描述 | 适用场景 |
|---------|---------|---------|
| 列表视图 | 以表格形式展示任务详细信息，支持排序、筛选 | 详细查看任务属性、批量管理 |
| 看板视图 | 按状态分列展示任务卡片，支持拖拽移动 | 可视化工作流、快速状态更新 |
| 甘特图视图 | 时间轴展示任务进度和依赖关系 | 项目时间规划、进度跟踪 |

#### 2.1.2 视图切换行为
- 视图选择器位于页面顶部工具栏左侧
- 切换视图时保留当前的筛选和排序条件
- 每种视图的配置（列显示、分组方式等）独立记忆
- 用户最后使用的视图在下次访问时自动恢复

### 2.2 任务列表视图（主视图）

#### 2.2.1 工具栏设计

工具栏从左到右包含以下功能区：

```
[视图切换] [新建任务] | [全部任务 ▼] [筛选 ▼] [排序 ▼] [分组 ▼] [字段配置 +]
```

**新建任务按钮**
- 带加号图标的主要操作按钮
- 点击后弹出任务创建表单
- 支持快捷键（Cmd/Ctrl + N）

**全部任务下拉菜单**
- 显示当前查看的任务范围
- 下拉选项：全部任务、我的任务、未完成、已完成等
- 选中项在按钮上显示

**筛选功能**
- 点击展开筛选面板
- 支持多条件组合筛选
- 筛选条件：项目、标签、优先级、状态、截止时间范围、负责人
- 已应用的筛选条件在按钮上显示数量徽章
- 支持保存常用筛选为快速筛选器

**排序功能**
- 下拉选择排序字段和方向
- 支持的排序字段：截止时间、优先级、创建时间、更新时间
- 支持升序/降序切换
- 支持手动拖拽排序（显示"拖拽自定义"选项）

**分组功能**
- 下拉选择分组维度
- 支持的分组方式：
  - 按状态分组（默认）
  - 按优先级分组
  - 按项目分组
  - 按标签分组
  - 按截止日期分组（今天、本周、本月、逾期、无截止）
  - 不分组
- 分组后显示每组任务数量
- 每个分组支持折叠/展开

**字段配置**
- 点击展开列配置面板
- 可勾选/取消显示的列
- 支持拖拽调整列顺序
- 支持调整列宽
- 预设字段：任务标题、状态、优先级、项目、标签、开始时间、截止时间、负责人

#### 2.2.2 表格布局设计

列表视图采用表格化布局，表头和数据行结构如下：

**表头结构**

| 列名 | 宽度 | 是否可排序 | 对齐方式 |
|------|------|-----------|---------|
| 复选框 | 40px | 否 | 居中 |
| 任务标题 | 自适应（最小200px） | 是 | 左对齐 |
| 状态 | 100px | 是 | 居中 |
| 优先级 | 80px | 是 | 居中 |
| 项目 | 120px | 是 | 左对齐 |
| 标签 | 150px | 否 | 左对齐 |
| 开始时间 | 140px | 是 | 居中 |
| 截止时间 | 140px | 是 | 居中 |
| 操作 | 80px | 否 | 居中 |

**数据行设计**
- 行高：48px（标准）、56px（宽松）可配置
- 悬停效果：背景色变为浅灰，右侧显示操作按钮
- 选中效果：左侧蓝色条、背景高亮
- 拖拽手柄：鼠标悬停在行首时显示，用于调整顺序

#### 2.2.3 分组展示

按状态分组示例：

```
▼ 待开发 (6)
  ┣━ 任务行1
  ┣━ 任务行2
  ┗━ 新建任务按钮

▼ 开发中 (1)
  ┗━ 任务行3

▼ 已放弃 (0)
  ┗━ 空状态提示
```

**分组头部**
- 左侧：折叠图标 + 分组名称 + 任务数量徽章
- 右侧：快速新建任务按钮
- 支持整组折叠/展开
- 折叠状态记忆到本地存储

**组内任务**
- 按设定的排序规则排列
- 支持组内拖拽调整顺序
- 支持跨组拖拽改变状态

### 2.3 看板视图设计

#### 2.3.1 布局结构

看板视图将任务按状态分为垂直列，每列一个泳道：

```
┌─────────────┬─────────────┬─────────────┬─────────────┐
│  待办 (6)    │ 进行中 (1)   │ 已完成 (0)   │ 已放弃 (0)   │
├─────────────┼─────────────┼─────────────┼─────────────┤
│ [任务卡片1]  │ [任务卡片4]  │              │              │
│ [任务卡片2]  │              │              │              │
│ [任务卡片3]  │              │              │              │
│ [+ 新建]     │ [+ 新建]     │ [+ 新建]     │ [+ 新建]     │
└─────────────┴─────────────┴─────────────┴─────────────┘
```

#### 2.3.2 列定义

| 列名称 | 对应状态 | 颜色标识 | 宽度 |
|-------|---------|---------|------|
| 待办 | todo | 灰色 | 280px |
| 进行中 | in_progress | 蓝色 | 280px |
| 已完成 | completed | 绿色 | 280px |
| 已放弃 | abandoned | 红色 | 280px |

#### 2.3.3 任务卡片设计

卡片结构从上到下：
1. 任务标题（加粗，可点击）
2. 项目标识（图标 + 项目名）
3. 标签列表（最多显示3个，超出显示"+N"）
4. 底部元信息行：
   - 左侧：优先级图标、截止时间
   - 右侧：负责人头像

卡片交互：
- 点击卡片打开详情弹窗
- 拖拽卡片可跨列移动（自动更新状态）
- 悬停显示快捷操作图标（编辑、删除）

### 2.4 甘特图视图设计

#### 2.4.1 布局结构

甘特图分为左右两部分：
- 左侧：任务列表（固定列）
- 右侧：时间轴区域（可横向滚动）

#### 2.4.2 左侧任务列表

| 列名 | 宽度 | 内容 |
|------|------|------|
| 展开/折叠 | 30px | 树形结构图标 |
| 任务名称 | 200px | 任务标题，支持缩进显示层级 |
| 状态 | 80px | 状态标签 |
| 负责人 | 80px | 用户头像 |

#### 2.4.3 时间轴设计

**时间刻度**
- 顶部显示日期刻度（可切换：天/周/月视图）
- 今天标记竖线高亮
- 周末背景色加深区分

**任务条**
- 横向条形表示任务持续时间
- 颜色按状态区分：待办-灰、进行中-蓝、已完成-绿
- 条上显示任务标题（空间足够时）
- 拖拽条形两端可调整开始/结束时间
- 拖拽条形主体可平移任务时间

**依赖关系线**
- 用箭头连线表示任务依赖
- 鼠标悬停高亮依赖路径

#### 2.4.4 甘特图工具栏

在甘特图视图下，工具栏增加以下专属功能：

| 功能 | 说明 |
|------|------|
| 时间范围选择 | 切换显示本周/本月/本季度/自定义范围 |
| 缩放控制 | 滑块调整时间轴密度 |
| 今天定位 | 快速滚动到今天位置 |
| 关键路径 | 高亮显示关键任务链 |

### 2.5 任务操作设计

#### 2.5.1 批量操作

**选择机制**
- 每行左侧复选框支持单选
- 表头复选框支持全选/取消全选
- 支持Shift+点击连续选择
- 支持Cmd/Ctrl+点击多选

**批量操作栏**
当选中任务后，顶部出现批量操作栏：

```
[已选中 N 项] | [修改状态] [设置优先级] [分配项目] [添加标签] [删除]
```

批量操作包括：
- 批量修改状态
- 批量设置优先级
- 批量分配项目
- 批量添加/移除标签
- 批量删除

#### 2.5.2 快捷操作

**行内快捷操作**（悬停显示）
- 编辑：打开任务详情弹窗
- 快速完成：单击完成图标
- 删除：移入垃圾筒
- 更多：展开更多操作菜单（复制、移动、设置提醒等）

**键盘快捷键**

| 快捷键 | 功能 |
|--------|------|
| N 或 C | 新建任务 |
| Enter | 打开选中任务详情 |
| Delete | 删除选中任务 |
| Space | 完成/取消完成 |
| ↑/↓ | 上下导航 |
| Cmd/Ctrl + A | 全选 |

### 2.6 筛选面板设计

#### 2.6.1 面板布局

筛选面板为右侧抽屉式弹出，宽度320px，包含以下筛选项：

**项目筛选**
- 多选下拉列表
- 显示项目颜色标识
- 支持搜索项目名称

**标签筛选**
- 标签云展示（按使用频率排序）
- 点击选中/取消
- 支持多选组合

**状态筛选**
- 按钮组形式
- 支持多选
- 显示每个状态的任务数量

**优先级筛选**
- 按钮组形式
- 支持多选
- 颜色区分优先级

**时间筛选**
- 快捷选项：今天、明天、本周、下周、本月、逾期
- 自定义日期范围选择器
- 支持选择"无截止时间"的任务

**其他筛选**
- 已完成/未完成
- 有/无标签
- 有/无项目
- 已置顶

#### 2.6.2 筛选结果

- 实时更新任务列表
- 面板底部显示"清空筛选"按钮
- 面板顶部显示当前筛选条件标签（可单独移除）
- 支持保存筛选器为"快速筛选"

### 2.7 字段配置面板

#### 2.7.1 可配置字段列表

| 字段名称 | 默认显示 | 说明 |
|---------|---------|------|
| 任务标题 | 是 | 不可隐藏 |
| 状态 | 是 | 当前任务状态 |
| 优先级 | 是 | 任务优先级 |
| 项目 | 是 | 所属项目 |
| 标签 | 是 | 关联标签 |
| 开始时间 | 否 | 任务开始时间 |
| 截止时间 | 是 | 任务截止时间 |
| 创建时间 | 否 | 任务创建时间 |
| 更新时间 | 否 | 最后更新时间 |
| 创建人 | 否 | 任务创建者 |
| 负责人 | 否 | 任务负责人 |
| 描述预览 | 否 | 任务描述前50字 |

#### 2.7.2 配置交互

- 勾选框控制显示/隐藏
- 拖拽调整列顺序
- 拖拽列边界调整列宽
- 重置为默认配置按钮

## 三、视觉设计规范

### 3.1 颜色系统

**状态颜色**

| 状态 | 主色 | 背景色 | 边框色 | 应用场景 |
|------|------|--------|--------|---------|
| 待办 | #6B7280 | #F9FAFB | #E5E7EB | 状态标签、看板列 |
| 进行中 | #3B82F6 | #EFF6FF | #BFDBFE | 状态标签、看板列 |
| 已完成 | #10B981 | #ECFDF5 | #A7F3D0 | 状态标签、看板列 |
| 已放弃 | #EF4444 | #FEF2F2 | #FECACA | 状态标签、看板列 |

**优先级颜色**

| 优先级 | 标识色 | 徽章色 | 说明 |
|--------|--------|--------|------|
| 紧急 | #DC2626 | #FEE2E2 | 红色系 |
| 高 | #F59E0B | #FEF3C7 | 橙色系 |
| 中 | #3B82F6 | #DBEAFE | 蓝色系 |
| 低 | #6B7280 | #F3F4F6 | 灰色系 |

### 3.2 组件样式

**表格行样式**
- 默认：白色背景，底部1px灰色边框
- 悬停：背景色 #F9FAFB，阴影提升
- 选中：左侧4px蓝色条，背景 #EFF6FF

**按钮样式**
- 主要按钮：蓝色渐变背景，白色文字
- 次要按钮：白色背景，灰色边框
- 文本按钮：无背景，蓝色文字

**下拉菜单**
- 圆角12px
- 阴影：0 4px 12px rgba(0,0,0,0.1)
- 菜单项悬停背景 #F9FAFB

**输入框**
- 高度36px
- 圆角8px
- 边框色 #E5E7EB，聚焦时变为 #3B82F6

### 3.3 图标使用规范

所有图标统一使用 lucide-react 图标库：

| 功能 | 图标名称 | 使用场景 |
|------|---------|---------|
| 列表视图 | List | 视图切换 |
| 看板视图 | Columns3 | 视图切换 |
| 甘特图 | GanttChart | 视图切换 |
| 新建 | Plus | 新建任务按钮 |
| 筛选 | Filter | 筛选按钮 |
| 排序 | ArrowUpDown | 排序按钮 |
| 分组 | Group | 分组按钮 |
| 配置 | Settings | 字段配置 |
| 日历 | Calendar | 日期选择 |
| 标签 | Tag | 标签展示 |
| 优先级 | Flag | 优先级标识 |
| 项目 | FolderKanban | 项目标识 |

### 3.4 响应式适配

**断点定义**

| 断点 | 宽度 | 布局调整 |
|------|------|---------|
| 桌面 | ≥1280px | 完整显示所有列 |
| 笔记本 | 1024-1279px | 隐藏次要列（创建时间、创建人等） |
| 平板 | 768-1023px | 仅显示核心列，其他信息折叠到卡片内 |
| 手机 | <768px | 切换为卡片列表模式 |

## 四、交互行为规范

### 4.1 加载状态

**初始加载**
- 显示骨架屏占位（表格行骨架）
- 加载完成后淡入动画

**局部刷新**
- 操作后立即乐观更新UI
- 后台同步数据，失败时回滚并提示

**分页加载**
- 滚动到底部自动加载下一页
- 加载中显示加载指示器

### 4.2 拖拽交互

**拖拽任务**
- 拖拽开始：卡片变半透明，显示拖拽虚影
- 拖拽中：目标位置显示插入线
- 拖拽结束：平滑动画移动到目标位置

**跨组拖拽**
- 拖动到其他分组时，自动更新对应属性（如状态）
- 松手前显示预览提示"移动到'进行中'"

### 4.3 动画规范

**过渡动画**
- 视图切换：淡入淡出，duration 200ms
- 分组展开/折叠：高度动画，duration 150ms
- 悬停效果：立即响应，无延迟

**微交互动画**
- 完成任务：✓图标缩放弹跳效果
- 删除任务：淡出并向右滑动
- 添加任务：从顶部淡入下滑

### 4.4 反馈提示

**成功提示**
- Toast通知，绿色背景
- 自动消失时间3秒
- 位置：屏幕右上角

**错误提示**
- Toast通知，红色背景
- 包含错误原因和建议操作
- 自动消失时间5秒

**确认对话框**
- 删除操作需二次确认
- 批量操作超过10项时需确认
- 模态对话框居中显示

## 五、数据交互设计

### 5.1 状态管理

**前端状态**
- 当前视图类型
- 筛选条件
- 排序规则
- 分组方式
- 字段显示配置
- 分组展开状态
- 选中任务ID列表

**本地持久化**
- 视图偏好设置存储到 localStorage
- 字段配置按用户存储
- 分组展开状态记忆

### 5.2 API交互

**任务列表查询**
- 接口：GET /api/tasks/
- 查询参数：
  - project: 项目ID
  - status: 状态筛选
  - priority: 优先级筛选
  - tags: 标签ID列表
  - search: 搜索关键词
  - ordering: 排序字段
  - page: 分页页码

**批量更新**
- 接口：PATCH /api/tasks/bulk_update/
- 请求体：
  - task_ids: 任务ID数组
  - updates: 更新字段对象

**拖拽排序**
- 接口：PATCH /api/tasks/{id}/
- 更新 order 字段
- 批量更新相邻任务的order值

## 六、实现优先级

### 阶段一：列表视图核心功能（高优先级）
1. 顶部工具栏布局和基础功能
2. 表格化任务列表展示
3. 状态分组功能
4. 基础筛选和排序
5. 字段显示配置

### 阶段二：视图切换与看板（中优先级）
1. 视图切换器实现
2. 看板视图布局
3. 看板拖拽交互
4. 视图配置独立记忆

### 阶段三：甘特图与高级功能（低优先级）
1. 甘特图时间轴渲染
2. 任务条展示和交互
3. 批量操作功能
4. 高级筛选器保存
5. 键盘快捷键支持

## 七、技术实现要点

### 7.1 推荐技术栈

**表格组件**
- 使用 @tanstack/react-table 构建高性能表格
- 支持排序、筛选、分组、虚拟滚动

**拖拽功能**
- 使用 @dnd-kit/core 实现拖拽交互
- 支持跨列表拖拽和排序

**甘特图**
- 考虑使用 gantt-task-react 或 frappe-gantt
- 或基于 SVG 自行实现轻量级甘特图

**日期处理**
- 使用 date-fns 进行日期格式化和计算
- 时区处理需要考虑用户本地时间

### 7.2 性能优化策略

**列表渲染优化**
- 对于大量任务（>100），启用虚拟滚动
- 使用 React.memo 避免不必要的重渲染
- 任务项使用 key 优化 diff 算法

**数据缓存**
- 使用 React Query 或 SWR 缓存任务数据
- 乐观更新提升交互响应速度
- 后台定期轮询更新数据

**分组计算**
- 使用 useMemo 缓存分组计算结果
- 只在依赖变化时重新计算

### 7.3 无障碍访问

**键盘导航**
- 所有操作支持键盘访问
- 焦点管理清晰可见
- 支持 Tab 键导航

**屏幕阅读器**
- 添加适当的 ARIA 标签
- 表格使用语义化 HTML
- 动态内容变化有提示

## 八、兼容性说明

**浏览器兼容性**
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

**移动端适配**
- 移动端优先展示卡片视图
- 手势支持：左滑删除、下拉刷新
- 触摸友好的按钮尺寸（最小44x44px）

**初始加载**
- 显示骨架屏占位（表格行骨架）
- 加载完成后淡入动画

**局部刷新**
- 操作后立即乐观更新UI
- 后台同步数据，失败时回滚并提示

**分页加载**
- 滚动到底部自动加载下一页
- 加载中显示加载指示器

### 4.2 拖拽交互

**拖拽任务**
- 拖拽开始：卡片变半透明，显示拖拽虚影
- 拖拽中：目标位置显示插入线
- 拖拽结束：平滑动画移动到目标位置

**跨组拖拽**
- 拖动到其他分组时，自动更新对应属性（如状态）
- 松手前显示预览提示"移动到'进行中'"

### 4.3 动画规范

**过渡动画**
- 视图切换：淡入淡出，duration 200ms
- 分组展开/折叠：高度动画，duration 150ms
- 悬停效果：立即响应，无延迟

**微交互动画**
- 完成任务：✓图标缩放弹跳效果
- 删除任务：淡出并向右滑动
- 添加任务：从顶部淡入下滑

### 4.4 反馈提示

**成功提示**
- Toast通知，绿色背景
- 自动消失时间3秒
- 位置：屏幕右上角

**错误提示**
- Toast通知，红色背景
- 包含错误原因和建议操作
- 自动消失时间5秒

**确认对话框**
- 删除操作需二次确认
- 批量操作超过10项时需确认
- 模态对话框居中显示

## 五、数据交互设计

### 5.1 状态管理

**前端状态**
- 当前视图类型
- 筛选条件
- 排序规则
- 分组方式
- 字段显示配置
- 分组展开状态
- 选中任务ID列表

**本地持久化**
- 视图偏好设置存储到 localStorage
- 字段配置按用户存储
- 分组展开状态记忆

### 5.2 API交互

**任务列表查询**
- 接口：GET /api/tasks/
- 查询参数：
  - project: 项目ID
  - status: 状态筛选
  - priority: 优先级筛选
  - tags: 标签ID列表
  - search: 搜索关键词
  - ordering: 排序字段
  - page: 分页页码

**批量更新**
- 接口：PATCH /api/tasks/bulk_update/
- 请求体：
  - task_ids: 任务ID数组
  - updates: 更新字段对象

**拖拽排序**
- 接口：PATCH /api/tasks/{id}/
- 更新 order 字段
- 批量更新相邻任务的order值

## 六、实现优先级

### 阶段一：列表视图核心功能（高优先级）
1. 顶部工具栏布局和基础功能
2. 表格化任务列表展示
3. 状态分组功能
4. 基础筛选和排序
5. 字段显示配置

### 阶段二：视图切换与看板（中优先级）
1. 视图切换器实现
2. 看板视图布局
3. 看板拖拽交互
4. 视图配置独立记忆

### 阶段三：甘特图与高级功能（低优先级）
1. 甘特图时间轴渲染
2. 任务条展示和交互
3. 批量操作功能
4. 高级筛选器保存
5. 键盘快捷键支持

## 七、技术实现要点

### 7.1 推荐技术栈

**表格组件**
- 使用 @tanstack/react-table 构建高性能表格
- 支持排序、筛选、分组、虚拟滚动

**拖拽功能**
- 使用 @dnd-kit/core 实现拖拽交互
- 支持跨列表拖拽和排序

**甘特图**
- 考虑使用 gantt-task-react 或 frappe-gantt
- 或基于 SVG 自行实现轻量级甘特图

**日期处理**
- 使用 date-fns 进行日期格式化和计算
- 时区处理需要考虑用户本地时间

### 7.2 性能优化策略

**列表渲染优化**
- 对于大量任务（>100），启用虚拟滚动
- 使用 React.memo 避免不必要的重渲染
- 任务项使用 key 优化 diff 算法

**数据缓存**
- 使用 React Query 或 SWR 缓存任务数据
- 乐观更新提升交互响应速度
- 后台定期轮询更新数据

**分组计算**
- 使用 useMemo 缓存分组计算结果
- 只在依赖变化时重新计算

### 7.3 无障碍访问

**键盘导航**
- 所有操作支持键盘访问
- 焦点管理清晰可见
- 支持 Tab 键导航

**屏幕阅读器**
- 添加适当的 ARIA 标签
- 表格使用语义化 HTML
- 动态内容变化有提示

## 八、兼容性说明

**浏览器兼容性**
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

**移动端适配**
- 移动端优先展示卡片视图
- 手势支持：左滑删除、下拉刷新
- 触摸友好的按钮尺寸（最小44x44px）
### 4.1 加载状态
